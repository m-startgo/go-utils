## 目的

为仓库内的 AI 编码代理与贡献者提供一份精简、可执行的规则清单，方便在每次沟通或代码改动时参考，以提高效率与准确率。

## 快速事实

- Module: `github.com/m-startgo/go-utils` (见 `go.mod`)
- Go 版本: 1.25
- 仓库风格: 功能分包，包名前缀为 `m_`（例如 `m_time`, `m_str`）
- 常用命令: `go test ./...`, `gofmt -w .`, `go vet ./...`

## 要求清单（AI 代理在每次相关任务必须遵守）

1. 语言

   - 用户可见文本（提示/日志/UI）使用中文；代码、命令、技术术语使用英文。提交信息和 README 可中英混合，但示例以英文为准。

2. 跨平台兼容

   - 生成代码应优先兼容 Windows/Linux/macOS。若使用平台特性，须在注释中标明受影响平台并给出回退方案。

3. 函数与导出 API

   - 导出函数/类型应有规范注释，说明功能、参数、返回值与错误行为。
   - 变更公共 API 时保证向后兼容；若破坏性变更，列出替代方案并自动生成/更新至少一个单元测试。

4. 库选择

   - 优先使用标准库或主流维护库（说明版本与许可证）。实验性库需 pin 版本并在注释中标注风险。

5. 代码风格与可测试性

   - 遵循 Go 官方风格（`gofmt`、`go vet`）。提倡小函数、单一职责、易测性。生成代码时同时考虑单元测试。

6. 错误处理

   - 错误日志需包含可追溯信息，格式：`err:<pkg.func>|<场景>|<错误信息>`。

7. 需求澄清

   - 遇到模糊或关键信息缺失，先列出缺失项与 1-2 个合理实现选项并请求用户确认；不得在关键约束上自行猜测。

8. 响应风格

   - 回复简洁、直接，优先给出可运行代码或明确修改建议；多方案时列出优劣并给出推荐。长内容先给结论再附详情。

9. 上下文感知

   - 生成或修改代码时，检查当前文件与已导入包，尽量复用现有实现与约定。

10. 性能与安全

- 必要时提出性能优化建议与安全风险提示（如注入、敏感信息）。

## 行为契约（输入/输出/错误模式）

- 输入: 用户请求、相关代码文件上下文、仓库约定文档（本文件即为）。
- 输出: 修改建议、代码补丁或新文件、测试（当修改代码时应附带至少一个测试）。
- 错误模式: 若无法完成（缺少权限/信息或违反安全策略），返回简短的失败原因并列出可行替代方案。

## 常用命令（PowerShell 示例）

```powershell
# 运行全部测试
go test ./... -v

# 显示未格式化的文件
gofmt -l .

# 自动格式化全部文件
gofmt -w .

# 静态检查
go vet ./...
```

## 何时需要提问

- 当任务缺少输入或对兼容性/版本有疑问时，列出 2 个实现选项与兼容性影响并请求选择。
